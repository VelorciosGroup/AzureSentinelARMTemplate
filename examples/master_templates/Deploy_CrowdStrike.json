{
	"$schema": "http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"client_Name": {
			"defaultValue": "BORRAR",
			"type": "string"
		},
		"keyvault_Name_Pack": {
			"defaultValue": "MSSP-Desarrollo-SOC",
			"type": "string"
		},
		"keyvault_ClientID_Pack": {
			"defaultValue": "ClientID-Crowdstrike",
			"type": "string"
		},
		"keyvault_Secret_Pack": {
			"defaultValue": "Secret-Crowdstrike",
			"type": "string"
		},
		"keyvault_BaseUrl_Pack": {
			"defaultValue": "BaseURL-Crowdstrike",
			"type": "string"
		}
	},
	"variables": {},
	"resources": [
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "OrchestatorPart_CrowdStrike_Auth_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_OrchestatorPart_CrowdStrike_Auth_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					},
					"connections_keyvault_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/keyvault"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_ClientSecret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					},
					"keyvault_BaseUrl": {
						"value": "[parameters('keyvault_BaseUrl_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_CrowdStrike_Device_Isolation_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_Action_CrowdStrike_Device_Isolation_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Action_CrowdStrike_Device_Isolation_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_CrowdStrike_Device_Isolation_Playbook')]"
					},
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Enrich_CrowdStrike_Recent_Alerts_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_Enrich_CrowdStrike_Recent_Alerts_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Enrich_CrowdStrike_Recent_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Enrich_CrowdStrike_Recent_Playbook_name')]"
					},
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					},
					"connections_azuresentinel_PRUEBA_Enrich_CrowdStrike_Recent_Playbook_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Enrich_CrowdStrike_Recent_Playbook"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Enrich_CrowdStrike_Device_Info_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_Enrich_CrowdStrike_Device_Info_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Enrich_CrowdStike_Device_Info_name": {
						"value": "[concat(parameters('client_Name'), '_Enrich_CrowdStike_Device_Info_Playbook')]"
					},
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					},
					"connections_azuresentinel_PRUEBA_Enrich_CrowdStike_Device_Info_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Enrich_CrowdStike_Device_Info"
					},
					"connections_MSSPDev_Deshabilitar_Reglas_ApiConnection_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Enrich_CrowdStike_Device_Info"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "OrchestatorPart_CrowdStrike_Block_IOC_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_OrchestatorPart_CrowdStrike_Block_IOC_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Automation_Block_IOC_name": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Block_IOC_Playbook')]"
					},
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_CrowdStrike_Block_Hash_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook",
				"OrchestatorPart_CrowdStrike_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_Action_CrowdStrike_Block_Hash_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Action_Crowdstrike_Block_Hash_name": {
						"value": "[concat(parameters('client_Name'), '_Action_CrowdStrike_Block_Hash_Playbook')]"
					},
					"workflows_PRUEBA_Automation_Block_IOC_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Block_IOC_Playbook')]"
					},
					"connections_azuresentinel_PRUEBA_Action_Crowdstrike_Block_Hash_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Action_Crowdstrike_Block_Hash"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_CrowdStrike_Block_Incident_Hashes_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook",
				"OrchestatorPart_CrowdStrike_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_Action_CrowdStrike_Block_Incident_Hashes_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Action_Crowdstrike_Block_incident_Hash_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Crowdstrike_Block_incident_Hash_Playbook')]"
					},
					"workflows_PRUEBA_Automation_Block_IOC_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Block_IOC_Playbook')]"
					},
					"connections_azuresentinel_PRUEBA_Action_Crowdstrike_Block_incident_Hash_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Action_Crowdstrike_Block_incident_Hash"
					},
					"connections_MSSPDev_Deshabilitar_Reglas_ApiConnection_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/MSSPDev_Deshabilitar_Reglas_ApiConnection"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "OrchestatorPart_CrowdStrike_Sync_Incidents_Playbook",
			"dependsOn": [
				"OrchestatorPart_CrowdStrike_Auth_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/CrowdStrike/Cliente_OrchestatorPart_CrowdStrike_Sync_Incidents_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_PRUEBA_Automation_Crowdstrike_Sync_Incidents_name": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_Crowdstrike_Sync_Incidents_Playbook')]"
					},
					"workflows_PRUEBA_Automation_CrowdStrike_Auth_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_OrchestatorPart_CrowdStrike_Auth_Playbook')]"
					},
					"connections_azuresentinel_PRUEBA_Automation_Crowdstrike_Sync_Incidents_externalid": {
						"value": "/subscriptions/a7be9652-e6e6-4284-b1b2-14b4079f777d/resourceGroups/MSSP_Sentinel_Desarollo_ResourceGroup/providers/Microsoft.Web/connections/azuresentinel-PRUEBA_Automation_Crowdstrike_Sync_Incidents"
					}
				}
			}
		}
	],
	"outputs": {
		"postDeployNote": {
			"type": "string",
			"value": "✅ Despliegue completado.\n⚠️ Ahora los playbooks tienen los siguientes permisos:\n- Lectura de KeyVault: OrchestatorPart_CrowdStrike_Auth_Playbook\n- Escritura en comentarios: Enrich_CrowdStrike_Recent_Alerts_Playbook, Enrich_CrowdStrike_Device_Info_Playbook"
		},
		"postDeployInstructions": {
			"type": "string",
			"value": "✅ Despliegue completado.\n⚠️ Revisa que los playbooks indicados tengan los permisos correctos antes de continuar con otras operaciones."
		}
	}
}