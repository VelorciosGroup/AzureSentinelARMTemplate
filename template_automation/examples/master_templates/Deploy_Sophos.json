{
	"$schema": "http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"client_Name": {
			"defaultValue": "BORRAR",
			"type": "string"
		},
		"keyvault_Name_Pack": {
			"defaultValue": "Cliente-Desarrollo-SOC",
			"type": "string"
		},
		"keyvault_ClientID_Pack": {
			"defaultValue": "sophos-velorcios-client-id",
			"type": "string"
		},
		"keyvault_Secret_Pack": {
			"defaultValue": "sophos-velorcios-client-secret",
			"type": "string"
		},
		"api_block_tag_Pack": {
			"defaultValue": "Blocked by SOC",
			"type": "string"
		}
	},
	"variables": {},
	"resources": [
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "OrchestatorPart_Sophos_Block_IOC_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_OrchestatorPart_Sophos_Block_IOC_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_azuresentinel_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid')]"
					},
					"connections_keyvault_velorsoc_keyvault_externalid": {
						"value": "[concat(parameters('client_Name'), '_keyvault_velorsoc_keyvault_externalid')]"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_Secret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Enrich_Sophos_Get_Recent_Alert_Info_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Enrich_Sophos_Get_Recent_Alert_Info_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Enrich_Sophos_Get_Recent_Alert_Info_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Velorcios_Enrich_Sophos_Get_Recent_Alert_Info_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Enrich_Sophos_Get_Recent_Alert_Info_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_azuresentinel_Velorcios_Enrich_Sophos_Get_Recent_Alert_Info_Playbook_externalid')]"
					},
					"connections_keyvault_velorsoc_keyvault_externalid": {
						"value": "[concat(parameters('client_Name'), '_keyvault_velorsoc_keyvault_externalid')]"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_Secret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Enrich_Sophos_Get_Device_Info_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Enrich_Sophos_Get_Device_Info_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Enrich_Sophos_Get_Device_Info_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Velorcios_Enrich_Sophos_Get_Device_Info_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Enrich_Sophos_Get_Device_Info_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_azuresentinel_Velorcios_Enrich_Sophos_Get_Device_Info_Playbook_externalid')]"
					},
					"connections_keyvault_velorsoc_keyvault_externalid": {
						"value": "[concat(parameters('client_Name'), '_keyvault_velorsoc_keyvault_externalid')]"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_Secret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Launch_Antivirus_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Launch_Antivirus_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Launch_Antivirus_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Launch_Antivirus_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Launch_Antivirus_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_azuresentinel_Velorcios_Action_Sophos_Launch_Antivirus_Playbook_externalid')]"
					},
					"connections_keyvault_velorsoc_keyvault_externalid": {
						"value": "[concat(parameters('client_Name'), '_keyvault_velorsoc_keyvault_externalid')]"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_Secret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Device_Isolation_Playbook",
			"dependsOn": [],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Device_Isolation_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Device_Isolation_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Device_Isolation_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Device_Isolation_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Device_Isolation_Playbook_externalid')]"
					},
					"connections_keyvault_velorsoc_keyvault_externalid": {
						"value": "[concat(parameters('client_Name'), '_keyvault_velorsoc_keyvault_externalid')]"
					},
					"keyvault_Name": {
						"value": "[parameters('keyvault_Name_Pack')]"
					},
					"keyvault_ClientID": {
						"value": "[parameters('keyvault_ClientID_Pack')]"
					},
					"keyvault_Secret": {
						"value": "[parameters('keyvault_Secret_Pack')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Block_IP_Playbook",
			"dependsOn": [
				"OrchestatorPart_Sophos_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Block_IP_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Block_IP_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_IP_Playbook_name')]"
					},
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Block_IP_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_IP_Playbook_externalid')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Block_Incident_IPs_Playbook",
			"dependsOn": [
				"OrchestatorPart_Sophos_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Block_Incident_IPs_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Block_Incident_IPs_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_IPs_Playbook_name')]"
					},
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Block_Incident_IPs_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_IPs_Playbook_externalid')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Block_Incident_Hashes_Playbook",
			"dependsOn": [
				"OrchestatorPart_Sophos_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Block_Incident_Hashes_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Block_Incident_Hashes_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_Hashes_Playbook_name')]"
					},
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Block_Incident_Hashes_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_Hashes_Playbook_externalid')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Block_Incident_Domains_Playbook",
			"dependsOn": [
				"OrchestatorPart_Sophos_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Block_Incident_Domains_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Block_Incident_Domains_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_Domains_Playbook_name')]"
					},
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_name')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Block_Incident_Domains_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Incident_Domains_Playbook_externalid')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2025-03-01",
			"name": "Action_Sophos_Block_Hash_Playbook",
			"dependsOn": [
				"OrchestatorPart_Sophos_Block_IOC_Playbook"
			],
			"properties": {
				"mode": "Incremental",
				"templateLink": {
					"uri": "https://raw.githubusercontent.com/VelorciosGroup/AzureSentinelARMTemplate/refs/heads/playbook_parse_automation/template_automation/out/Sophos/Cliente_Action_Sophos_Block_Hash_Playbook.json",
					"contentVersion": "1.0.0.0"
				},
				"parameters": {
					"workflows_Velorcios_Action_Sophos_Block_Hash_Playbook_name": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Hash_Playbook_name')]"
					},
					"workflows_Velorcios_Automation_Sophos_Block_IOC_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Automation_Sophos_Block_IOC_Playbook_externalid')]"
					},
					"connections_azuresentinel_Velorcios_Action_Sophos_Block_Hash_Playbook_externalid": {
						"value": "[concat(parameters('client_Name'), '_Action_Sophos_Block_Hash_Playbook_externalid')]"
					}
				}
			}
		}
	],
	"outputs": {
		"postDeployNote": {
			"type": "string",
			"value": "✅ Despliegue completado.\n⚠️ Ahora debes asignar permisos de comentarios a los playbooks: \n⚫ Cliente_Enrich_Sophos_Get_Device_Info_Playbook\n⚫ Cliente_Enrich_Sophos_Get_Recent_Alert_Info_Playbook\nY permisos de keyvault a los playbooks:\n⚫ Cliente_Enrich_Sophos_Get_Recent_Alert_Info_Playbook\n⚫ Cliente_Enrich_Sophos_Get_Device_Info_Playbook\n⚫ Cliente_OrchestatorPart_Sophos_Block_IOC_Playbook\n⚫ Cliente_Action_Sophos_Launch_Antivirus_Playbook\n⚫ Cliente_Action_Sophos_Device_Isolation_Playbook\n⚫ Cliente_Action_Sophos_Block_IP_Playbook\n"
		},
		"postDeployApiTagInstructions": {
			"type": "string",
			"value": "Para asignar correctamente el tag en las policy ⚠️: Acceder a Sophos Central → Mis productos → Endpoint → Policy → Configuración → Añadir nuevo. En el campo \"Etiqueta de sitio web\" hay que poner el tag escogido en el despliegue y en el campo \"Acción\" hay que poner la opción de bloquear"
		}
	}
}